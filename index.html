<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Query the API (JS Version)</title>
</head>
<body>
    <h1>Query the API</h1>
    <form id="apiForm">
        <label for="endpoint">Endpoint:</label>
        <select id="endpoint" name="endpoint">
            <option value="random">Random</option>
            <option value="species">Species</option>
            <!-- Add more endpoints as needed -->
        </select>
        <label for="query">Search Query:</label>
        <input type="text" id="query" name="query">
        <button type="submit">Search</button>
    </form>
    <div id="results"></div>
    <script>
        document.getElementById('apiForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const endpoint = document.getElementById('endpoint').value;
            const query = document.getElementById('query').value;
            let url = `https://aes.shenlu.me/api/v1/${endpoint}`;
            if (query) {
                url += `?q=${encodeURIComponent(query)}`;
            }

            document.getElementById('results').innerHTML = "Loading...";

            try {
                const response = await fetch(url);
                const data = await response.json();

                if (!data || (Array.isArray(data) && data.length === 0)) {
                    document.getElementById('results').innerHTML = "empty";
                    return;
                }

                if (endpoint === 'species' && Array.isArray(data)) {
                    let html = "<h1>Species</h1>";
                    data.forEach(item => {
                        html += `<li>ID: ${item.id ?? 'No ID'}</li>`;
                        html += `<li>Scientific name: ${item.scientific_name ?? 'No name'}</li>`;
                        html += `<li>Common Name: ${item.common_name ?? 'No common Name'}</li>`;
                        html += `<li>Group: ${item.group ?? ''}</li>`;
                        html += `<li>Conservation Status: ${item.conservation_status ?? ''}</li>`;
                        html += `<hr/>`;
                    });
                    document.getElementById('results').innerHTML = html;
                } else {
                    let html = "<h1>Random</h1>";
                    html += `<li>ID: ${data.id ?? 'No ID'}</li>`;
                    html += `<li>Scientific name: ${data.scientific_name ?? 'No name'}</li>`;
                    html += `<li>Common Name: ${data.common_name ?? 'No common Name'}</li>`;
                    html += `<li>Group: ${data.group ?? ''}</li>`;
                    html += `<li>Conservation Status: ${data.conservation_status ?? ''}</li>`;
                    document.getElementById('results').innerHTML = html;
                }
            } catch (err) {
                document.getElementById('results').innerHTML = "Error fetching data.";
            }
        });
    </script>